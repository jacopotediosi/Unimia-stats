/*!
 * @license
 * chartjs-plugin-zoom
 * http://chartjs.org/
 * Version: 0.7.7
 *
 * Copyright 2020 Chart.js Contributors
 * Released under the MIT license
 * https://github.com/chartjs/chartjs-plugin-zoom/blob/master/LICENSE.md
 */
 (function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o(require("chart.js"),require("hammerjs")):"function"==typeof define&&define.amd?define(["chart.js","hammerjs"],o):(e=e||self,e.ChartZoom=o(e.Chart,e.Hammer))})(this,function(e,o){"use strict";function t(e,o){var t={};void 0!==e.options.pan&&(t.pan=e.options.pan),void 0!==e.options.zoom&&(t.zoom=e.options.zoom);var n=e.$zoom;o=n._options=z.merge({},[o,t]);var a=n._node,i=o.zoom&&o.zoom.enabled,m=o.zoom.drag;i&&!m?a.addEventListener("wheel",n._wheelHandler):a.removeEventListener("wheel",n._wheelHandler),i&&m?(a.addEventListener("mousedown",n._mouseDownHandler),a.ownerDocument.addEventListener("mouseup",n._mouseUpHandler)):(a.removeEventListener("mousedown",n._mouseDownHandler),a.removeEventListener("mousemove",n._mouseMoveHandler),a.ownerDocument.removeEventListener("mouseup",n._mouseUpHandler))}function n(e){var o=e.$zoom._originalOptions;z.each(e.scales,function(e){o[e.id]||(o[e.id]=z.clone(e.options))}),z.each(o,function(t,n){e.scales[n]||delete o[n]})}function a(e,o,t){return void 0===e||("string"==typeof e?-1!==e.indexOf(o):"function"==typeof e&&-1!==e({chart:t}).indexOf(o))}function i(e,o){if(e.scaleAxes&&e.rangeMax&&!z.isNullOrUndef(e.rangeMax[e.scaleAxes])){var t=e.rangeMax[e.scaleAxes];o>t&&(o=t)}return o}function m(e,o){if(e.scaleAxes&&e.rangeMin&&!z.isNullOrUndef(e.rangeMin[e.scaleAxes])){var t=e.rangeMin[e.scaleAxes];o<t&&(o=t)}return o}function r(e,o,t,n){var a=e.chart.data.labels,r=e.minIndex,l=a.length-1,s=e.maxIndex,c=n.sensitivity,u=e.isHorizontal()?e.left+e.width/2:e.top+e.height/2,d=e.isHorizontal()?t.x:t.y;_.zoomCumulativeDelta=o>1?_.zoomCumulativeDelta+1:_.zoomCumulativeDelta-1,Math.abs(_.zoomCumulativeDelta)>c&&(_.zoomCumulativeDelta<0?(d>=u?r<=0?s=Math.min(l,s+1):r=Math.max(0,r-1):d<u&&(s>=l?r=Math.max(0,r-1):s=Math.min(l,s+1)),_.zoomCumulativeDelta=0):_.zoomCumulativeDelta>0&&(d>=u?r=r<s?r=Math.min(s,r+1):r:d<u&&(s=s>r?s=Math.max(r,s-1):s),_.zoomCumulativeDelta=0),e.options.ticks.min=m(n,a[r]),e.options.ticks.max=i(n,a[s]))}function l(e,o,t,n){var a=e.max-e.min,r=a*(o-1),l=e.isHorizontal()?t.x:t.y,s=(e.getValueForPixel(l)-e.min)/a,c=1-s,u=r*s,d=r*c;e.options.ticks.min=m(n,e.min+u),e.options.ticks.max=i(n,e.max-d)}function s(e,o,t,n){l(e,o,t,n);var a=e.options;a.time&&(a.time.min&&(a.time.min=a.ticks.min),a.time.max&&(a.time.max=a.ticks.max))}function c(e,o,t,n){var a=y[e.type];a&&a(e,o,t,n)}function u(e,o,t,i,m,r){var l=e.chartArea;i||(i={x:(l.left+l.right)/2,y:(l.top+l.bottom)/2});var s=e.$zoom._options.zoom;if(s.enabled){n(e);var u,d="function"==typeof s.mode?s.mode({chart:e}):s.mode;u="xy"===d&&void 0!==m?m:"xy",z.each(e.scales,function(n){n.isHorizontal()&&a(d,"x",e)&&a(u,"x",e)?(s.scaleAxes="x",c(n,o,i,s)):!n.isHorizontal()&&a(d,"y",e)&&a(u,"y",e)&&(s.scaleAxes="y",c(n,t,i,s))}),r?e.update({duration:r,easing:"easeOutQuad"}):e.update(0),"function"==typeof s.onZoom&&s.onZoom({chart:e})}}function d(e,o,t){var n,a=e.chart.data.labels,r=a.length-1,l=Math.max(e.ticks.length,1),s=t.speed,c=e.minIndex,u=Math.round(e.width/(l*s));_.panCumulativeDelta+=o,c=_.panCumulativeDelta>u?Math.max(0,c-1):_.panCumulativeDelta<-u?Math.min(r-l+1,c+1):c,_.panCumulativeDelta=c!==e.minIndex?0:_.panCumulativeDelta,n=Math.min(r,c+l-1),e.options.ticks.min=m(t,a[c]),e.options.ticks.max=i(t,a[n])}function p(e,o,t){var n=e.options.ticks,a=e.min,i=e.max,m=e.getValueForPixel(e.getPixelForValue(a)-o),r=e.getValueForPixel(e.getPixelForValue(i)-o);m=m.valueOf?m.valueOf():m,r=r.valueOf?r.valueOf():r;var l,s=m,c=r;t.scaleAxes&&t.rangeMin&&!z.isNullOrUndef(t.rangeMin[t.scaleAxes])&&(s=t.rangeMin[t.scaleAxes]),t.scaleAxes&&t.rangeMax&&!z.isNullOrUndef(t.rangeMax[t.scaleAxes])&&(c=t.rangeMax[t.scaleAxes]),m>=s&&r<=c?(n.min=m,n.max=r):m<s?(l=a-s,n.min=s,n.max=i-l):r>c&&(l=c-i,n.max=c,n.min=a+l)}function f(e,o,t){p(e,o,t);var n=e.options;n.time&&(n.time.min&&(n.time.min=n.ticks.min),n.time.max&&(n.time.max=n.ticks.max))}function v(e,o,t){var n=M[e.type];n&&n(e,o,t)}function h(e,o,t){n(e);var i=e.$zoom._options.pan;if(i.enabled){var m="function"==typeof i.mode?i.mode({chart:e}):i.mode;z.each(e.scales,function(n){n.isHorizontal()&&a(m,"x",e)&&0!==o?(i.scaleAxes="x",v(n,o,i)):!n.isHorizontal()&&a(m,"y",e)&&0!==t&&(i.scaleAxes="y",v(n,t,i))}),e.update(0),"function"==typeof i.onPan&&i.onPan({chart:e})}}function x(e){for(var o=e.scales,t=Object.keys(o),n=0;n<t.length;n++){var a=o[t[n]];if(a.isHorizontal())return a}}function g(e){for(var o=e.scales,t=Object.keys(o),n=0;n<t.length;n++){var a=o[t[n]];if(!a.isHorizontal())return a}}e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o;var z=e.helpers,_=e.Zoom=e.Zoom||{},y=_.zoomFunctions=_.zoomFunctions||{},M=_.panFunctions=_.panFunctions||{};e.Zoom.defaults=e.defaults.global.plugins.zoom={pan:{enabled:!1,mode:"xy",speed:20,threshold:10},zoom:{enabled:!1,mode:"xy",sensitivity:3,speed:.1}},_.zoomFunctions.category=r,_.zoomFunctions.time=s,_.zoomFunctions.linear=l,_.zoomFunctions.logarithmic=l,_.panFunctions.category=d,_.panFunctions.time=f,_.panFunctions.linear=p,_.panFunctions.logarithmic=p,_.panCumulativeDelta=0,_.zoomCumulativeDelta=0;var C={id:"zoom",afterInit:function(e){e.resetZoom=function(){n(e);var o=e.$zoom._originalOptions;z.each(e.scales,function(e){var t=e.options.time,n=e.options.ticks;o[e.id]?(t&&(t.min=o[e.id].time.min,t.max=o[e.id].time.max),n&&(n.min=o[e.id].ticks.min,n.max=o[e.id].ticks.max)):(t&&(delete t.min,delete t.max),n&&(delete n.min,delete n.max))}),e.update()}},beforeUpdate:function(e,o){t(e,o)},beforeInit:function(e,n){e.$zoom={_originalOptions:{}};var i=e.$zoom._node=e.ctx.canvas;t(e,n);var m=e.$zoom._options,r=m.pan&&m.pan.threshold;e.$zoom._mouseDownHandler=function(o){i.addEventListener("mousemove",e.$zoom._mouseMoveHandler),e.$zoom._dragZoomStart=o},e.$zoom._mouseMoveHandler=function(o){e.$zoom._dragZoomStart&&(e.$zoom._dragZoomEnd=o,e.update(0))},e.$zoom._mouseUpHandler=function(o){if(e.$zoom._dragZoomStart){i.removeEventListener("mousemove",e.$zoom._mouseMoveHandler);var t=e.$zoom._dragZoomStart,n=t.target.getBoundingClientRect().left,r=Math.min(t.clientX,o.clientX)-n,l=Math.max(t.clientX,o.clientX)-n,s=t.target.getBoundingClientRect().top,c=Math.min(t.clientY,o.clientY)-s,d=Math.max(t.clientY,o.clientY)-s,p=l-r,f=d-c;e.$zoom._dragZoomStart=null,e.$zoom._dragZoomEnd=null;var v=m.zoom&&m.zoom.threshold||0;if(!(p<=v&&f<=v)){var h=e.chartArea,x=e.$zoom._options.zoom,g=h.right-h.left,z=a(x.mode,"x",e),_=z&&p?1+(g-p)/g:1,y=h.bottom-h.top,M=a(x.mode,"y",e),C=M&&f?1+(y-f)/y:1;u(e,_,C,{x:(r-h.left)/(1-p/g)+h.left,y:(c-h.top)/(1-f/y)+h.top},void 0,x.drag.animationDuration),"function"==typeof x.onZoomComplete&&x.onZoomComplete({chart:e})}}};var l=null;if(e.$zoom._wheelHandler=function(o){if(o.cancelable&&o.preventDefault(),void 0!==o.deltaY){var t=o.target.getBoundingClientRect(),n=o.clientX-t.left,a=o.clientY-t.top,i={x:n,y:a},m=e.$zoom._options.zoom,r=m.speed;o.deltaY>=0&&(r=-r),u(e,1+r,1+r,i),clearTimeout(l),l=setTimeout(function(){"function"==typeof m.onZoomComplete&&m.onZoomComplete({chart:e})},250)}},o){var s,c=e.$zoom._options.zoom,d=e.$zoom._options.pan,p=new o.Manager(i);c&&c.enabled&&p.add(new o.Pinch),d&&d.enabled&&p.add(new o.Pan({threshold:r}));var f=function(o){var t,n=1/s*o.scale,a=o.target.getBoundingClientRect(),i=o.center.x-a.left,m=o.center.y-a.top,r={x:i,y:m},l=Math.abs(o.pointers[0].clientX-o.pointers[1].clientX),d=Math.abs(o.pointers[0].clientY-o.pointers[1].clientY),p=l/d;t=p>.3&&p<1.7?"xy":l>d?"x":"y",u(e,n,n,r,t),"function"==typeof c.onZoomComplete&&c.onZoomComplete({chart:e}),s=o.scale};p.on("pinchstart",function(){s=1}),p.on("pinch",f),p.on("pinchend",function(e){f(e),s=null,_.zoomCumulativeDelta=0});var v=null,x=null,g=!1,z=function(o){if(null!==v&&null!==x){g=!0;var t=o.deltaX-v,n=o.deltaY-x;v=o.deltaX,x=o.deltaY,h(e,t,n)}};p.on("panstart",function(e){v=0,x=0,z(e)}),p.on("panmove",z),p.on("panend",function(){v=null,x=null,_.panCumulativeDelta=0,setTimeout(function(){g=!1},500);var o=e.$zoom._options.pan;"function"==typeof o.onPanComplete&&o.onPanComplete({chart:e})}),e.$zoom._ghostClickHandler=function(e){g&&e.cancelable&&(e.stopImmediatePropagation(),e.preventDefault())},i.addEventListener("click",e.$zoom._ghostClickHandler),e._mc=p}},beforeDatasetsDraw:function(e){var o=e.ctx;if(e.$zoom._dragZoomEnd){var t=x(e),n=g(e),i=e.$zoom._dragZoomStart,m=e.$zoom._dragZoomEnd,r=t.left,l=t.right,s=n.top,c=n.bottom;if(a(e.$zoom._options.zoom.mode,"x",e)){var u=i.target.getBoundingClientRect().left;r=Math.min(i.clientX,m.clientX)-u,l=Math.max(i.clientX,m.clientX)-u}if(a(e.$zoom._options.zoom.mode,"y",e)){var d=i.target.getBoundingClientRect().top;s=Math.min(i.clientY,m.clientY)-d,c=Math.max(i.clientY,m.clientY)-d}var p=l-r,f=c-s,v=e.$zoom._options.zoom.drag;o.save(),o.beginPath(),o.fillStyle=v.backgroundColor||"rgba(225,225,225,0.3)",o.fillRect(r,s,p,f),v.borderWidth>0&&(o.lineWidth=v.borderWidth,o.strokeStyle=v.borderColor||"rgba(225,225,225)",o.strokeRect(r,s,p,f)),o.restore()}},destroy:function(e){if(e.$zoom){var o=e.$zoom,t=o._node;t.removeEventListener("mousedown",o._mouseDownHandler),t.removeEventListener("mousemove",o._mouseMoveHandler),t.ownerDocument.removeEventListener("mouseup",o._mouseUpHandler),t.removeEventListener("wheel",o._wheelHandler),t.removeEventListener("click",o._ghostClickHandler),delete e.$zoom;var n=e._mc;n&&(n.remove("pinchstart"),n.remove("pinch"),n.remove("pinchend"),n.remove("panstart"),n.remove("pan"),n.remove("panend"),n.destroy())}}};return e.plugins.register(C),C});